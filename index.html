<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picnic Panic: Time Attack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- CORE SETTINGS --- */
        body, a, button, input, .ant {
            cursor: none !important;
            user-select: none;
            overflow: hidden;
        }

        /* --- LAYERS --- */
        #ui-layer { z-index: 10; position: relative; pointer-events: none; }
        #timer-layer { z-index: 20; position: fixed; top: 20px; right: 20px; pointer-events: none; }
        #game-layer { z-index: 9000; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #cursor-layer { z-index: 9999; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #overlay-layer { z-index: 10000; }

        /* --- THE CURSOR (Cookie) --- */
        #custom-cursor {
            position: absolute;
            width: 50px;
            height: 50px;
            will-change: transform;
            filter: drop-shadow(3px 3px 2px rgba(0,0,0,0.3));
            transform-origin: top left;
        }

        /* --- THE ANTS (SVG) --- */
        .ant {
            position: absolute;
            width: 30px;
            height: 30px;
            will-change: transform;
        }

        .ant-svg {
            width: 100%;
            height: 100%;
            fill: #3f2016;
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.2));
        }

        /* Eating Animation */
        .ant.eating .ant-svg {
            animation: chomp 0.15s infinite alternate;
            fill: #8a1c1c;
        }
        
        @keyframes chomp {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }

        /* --- BACKGROUND --- */
        .picnic-bg {
            background-color: #ffdede;
            background-image: 
                linear-gradient(45deg, #ffcccc 25%, transparent 25%, transparent 75%, #ffcccc 75%, #ffcccc),
                linear-gradient(45deg, #ffcccc 25%, transparent 25%, transparent 75%, #ffcccc 75%, #ffcccc);
            background-position: 0 0, 20px 20px;
            background-size: 40px 40px;
        }

        /* --- UI CARD (Old Version) --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 4px solid #fecaca;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            animation: float 3s ease-in-out infinite;
            pointer-events: auto; /* Allow clicking buttons if needed */
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* --- TIMER CARD (New) --- */
        .timer-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            border: 3px solid #fecaca;
            border-radius: 15px;
            padding: 10px 20px;
            font-family: monospace;
            font-size: 1.5rem;
            color: #dc2626;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- HEALTH --- */
        #health-wrapper {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 12px;
            background: rgba(255,255,255,0.6);
            border-radius: 20px;
            border: 2px solid rgba(0,0,0,0.1);
            z-index: 50;
            overflow: hidden;
        }
        #health-bar {
            width: 100%;
            height: 100%;
            background: #22c55e;
            transition: width 0.05s linear, background-color 0.2s;
        }
    </style>
</head>
<body class="picnic-bg h-screen w-screen">

    <!-- TIMER LAYER -->
    <div id="timer-layer">
        <div class="timer-card">
            ‚è±Ô∏è <span id="timer-display">00:00</span>
        </div>
    </div>

    <!-- UI LAYER (Original) -->
    <main id="ui-layer" class="w-full h-full flex flex-col items-center justify-center p-4">
        <div class="glass-card p-8 max-w-xl text-center">
            <h1 class="text-5xl font-bold text-red-500 mb-2">Picnic Survival</h1>
            <p class="text-lg text-gray-600 mb-6">You are the cookie. They are the ants.</p>
            <div class="bg-red-50 p-4 rounded-xl text-red-800 text-sm font-medium">
                Keep moving! If they touch you, you shrink!
            </div>
            <div class="mt-6 flex justify-center gap-4">
                <button class="px-6 py-3 bg-red-400 text-white rounded-full font-bold hover:bg-red-500 transition shadow-lg cursor-none">
                    Menu
                </button>
                <button class="px-6 py-3 bg-orange-400 text-white rounded-full font-bold hover:bg-orange-500 transition shadow-lg cursor-none">
                    Help
                </button>
            </div>
        </div>
    </main>

    <!-- GAME LAYER (Ants) -->
    <div id="game-layer"></div>

    <!-- CURSOR LAYER (Cookie) -->
    <div id="cursor-layer">
        <div id="custom-cursor">
            <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 5 L 45 95 L 55 55 L 95 45 L 5 5 Z" 
                      fill="#eab308" stroke="#92400e" stroke-width="3" stroke-linejoin="round"/>
                <path d="M5 5 L 45 95 L 55 55 L 95 45 L 5 5 Z" fill="url(#cookieGradient)" opacity="0.4"/>
                <defs>
                    <radialGradient id="cookieGradient">
                        <stop offset="0%" stop-color="#fff" />
                        <stop offset="100%" stop-color="#b45309" />
                    </radialGradient>
                </defs>
                <circle cx="30" cy="30" r="6" fill="#3f2016" />
                <circle cx="55" cy="65" r="5" fill="#3f2016" />
                <circle cx="70" cy="40" r="6" fill="#3f2016" />
                <circle cx="25" cy="55" r="4" fill="#3f2016" />
                <g transform="translate(25, 25)">
                    <circle cx="0" cy="0" r="10" fill="white" stroke="#3f2016" stroke-width="1"/>
                    <circle class="eye-pupil" id="pupil-l" cx="0" cy="0" r="4" fill="black" />
                </g>
                <g transform="translate(50, 35)">
                    <circle cx="0" cy="0" r="10" fill="white" stroke="#3f2016" stroke-width="1"/>
                    <circle class="eye-pupil" id="pupil-r" cx="0" cy="0" r="4" fill="black" />
                </g>
            </svg>
        </div>
    </div>

    <!-- HEALTH BAR -->
    <div id="health-wrapper">
        <div id="health-bar"></div>
    </div>

    <!-- GAME OVER LAYER -->
    <div id="overlay-layer" class="hidden fixed inset-0 bg-black/85 flex-col items-center justify-center text-white text-center p-4">
        <div class="text-7xl mb-4">üç™üíÄ</div>
        <h1 class="text-5xl font-bold text-red-500 mb-2">DEVOURED!</h1>
        <p class="text-gray-300 text-xl mb-2">Not even a crumb left.</p>
        <p id="final-time" class="text-2xl text-yellow-400 font-mono font-bold mb-8">You survived: 00:00</p>
        <button onclick="location.reload()" class="px-8 py-4 bg-white text-black rounded-full font-bold text-xl hover:scale-110 transition cursor-none">
            Try Again
        </button>
    </div>

    <script>
        (function() {
            // --- CONFIG ---
            const ANT_COUNT = 15;
            const ANT_SPEED = 2.0; 
            const SHRINK_RATE = 0.004;
            const EATING_DIST = 30;

            // --- STATE ---
            let gameW = window.innerWidth || 800;
            let gameH = window.innerHeight || 600;
            
            let mouse = { x: gameW/2, y: gameH/2 };
            let cursorScale = 1.0;
            let isGameOver = false;
            let ants = [];
            
            // Timer State
            let isGameActive = false;
            let startTime = 0;
            let elapsedTime = 0;

            // --- ELEMENTS ---
            const cursorEl = document.getElementById('custom-cursor');
            const gameLayer = document.getElementById('game-layer');
            const healthBar = document.getElementById('health-bar');
            const overlay = document.getElementById('overlay-layer');
            const timerDisplay = document.getElementById('timer-display');
            const finalTimeDisplay = document.getElementById('final-time');
            const pupilL = document.getElementById('pupil-l');
            const pupilR = document.getElementById('pupil-r');

            // --- SVG STRING FOR ANTS ---
            const ANT_SVG = `
            <svg class="ant-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 30 L5 20 M20 50 L5 50 M20 70 L5 80 M80 30 L95 20 M80 50 L95 50 M80 70 L95 80" stroke="currentColor" stroke-width="8" stroke-linecap="round" />
                <ellipse cx="50" cy="20" rx="15" ry="12" fill="currentColor" />
                <ellipse cx="50" cy="45" rx="12" ry="10" fill="currentColor" />
                <ellipse cx="50" cy="75" rx="20" ry="25" fill="currentColor" />
                <path d="M40 15 L30 5 M60 15 L70 5" stroke="currentColor" stroke-width="4" />
            </svg>`;

            // --- INIT ---
            function init() {
                for(let i = 0; i < ANT_COUNT; i++) {
                    createAnt();
                }
                loop();
            }

            function formatTime(ms) {
                const seconds = Math.floor(ms / 1000);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            function createAnt() {
                const el = document.createElement('div');
                el.className = 'ant';
                el.innerHTML = ANT_SVG;
                gameLayer.appendChild(el);

                const angle = Math.random() * Math.PI * 2;
                const dist = Math.max(gameW, gameH) * 0.7; 
                
                const startX = (gameW/2) + Math.cos(angle) * dist;
                const startY = (gameH/2) + Math.sin(angle) * dist;

                ants.push({
                    el: el,
                    x: startX,
                    y: startY,
                    angle: angle * (180/Math.PI) + 90,
                    speed: ANT_SPEED + Math.random()
                });
            }

            // --- MOUSE TRACKING ---
            document.addEventListener('mousemove', (e) => {
                if(isGameOver) return;
                
                // Start timer on first movement
                if (!isGameActive) {
                    isGameActive = true;
                    startTime = Date.now();
                }

                mouse.x = e.clientX;
                mouse.y = e.clientY;

                const xOff = Math.min(Math.max(e.movementX, -4), 4);
                const yOff = Math.min(Math.max(e.movementY, -4), 4);
                pupilL.style.transform = `translate(${xOff}px, ${yOff}px)`;
                pupilR.style.transform = `translate(${xOff}px, ${yOff}px)`;
            });

            window.addEventListener('resize', () => {
                gameW = window.innerWidth;
                gameH = window.innerHeight;
            });

            // --- GAME LOOP ---
            function loop() {
                if(isGameOver) return;

                // Update Timer
                if(isGameActive) {
                    elapsedTime = Date.now() - startTime;
                    timerDisplay.innerText = formatTime(elapsedTime);
                }

                let eaters = 0;

                cursorEl.style.transform = `translate(${mouse.x}px, ${mouse.y}px) scale(${cursorScale})`;

                ants.forEach(ant => {
                    const dx = mouse.x - ant.x;
                    const dy = mouse.y - ant.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);

                    if(dist > EATING_DIST) {
                        // Move towards cursor (No separation logic here - back to V2 behavior)
                        const vx = (dx / dist) * ant.speed;
                        const vy = (dy / dist) * ant.speed;
                        ant.x += vx;
                        ant.y += vy;
                        ant.angle = Math.atan2(dy, dx) * (180/Math.PI) + 90;
                        
                        if(ant.el.classList.contains('eating')) {
                            ant.el.classList.remove('eating');
                        }
                    } else {
                        // Eating
                        eaters++;
                        if(!ant.el.classList.contains('eating')) {
                            ant.el.classList.add('eating');
                        }
                        ant.x = mouse.x + (Math.random()-0.5) * 20 * cursorScale;
                        ant.y = mouse.y + (Math.random()-0.5) * 20 * cursorScale;
                    }

                    ant.el.style.transform = `translate(${ant.x}px, ${ant.y}px) rotate(${ant.angle}deg)`;
                });

                if(eaters > 0) {
                    cursorScale -= (SHRINK_RATE * eaters);
                    if(cursorScale <= 0.05) {
                        gameOver();
                    }
                    if(cursorScale < 0.3) healthBar.style.backgroundColor = '#ef4444';
                    else if(cursorScale < 0.6) healthBar.style.backgroundColor = '#eab308';
                    
                    if(Math.random() < 0.2) spawnCrumb();
                }
                
                healthBar.style.width = Math.max(0, cursorScale * 100) + '%';

                requestAnimationFrame(loop);
            }

            function spawnCrumb() {
                const c = document.createElement('div');
                c.style.cssText = `
                    position:fixed; width:4px; height:4px; background:#8B4513; border-radius:50%;
                    left:${mouse.x}px; top:${mouse.y}px; pointer-events:none; z-index:9995;
                `;
                document.body.appendChild(c);
                let y = mouse.y, op = 1;
                function fall() {
                    y += 2; op -= 0.05;
                    c.style.top = y + 'px'; c.style.opacity = op;
                    if(op > 0) requestAnimationFrame(fall); else c.remove();
                }
                requestAnimationFrame(fall);
            }

            function gameOver() {
                isGameOver = true;
                cursorEl.style.display = 'none';
                
                // Show final time
                finalTimeDisplay.innerText = `You survived: ${formatTime(elapsedTime)}`;
                
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            }

            init();
            cursorEl.style.transform = `translate(${gameW/2}px, ${gameH/2}px)`;
        })();
    </script>
</body>
</html>
